openapi: 3.0.3
info:
  title: Orange Money API
  description: |
    API REST compl√®te pour la gestion des transactions mobiles Orange Money.
    
    ## Fonctionnalit√©s principales
    - üí∞ **Transactions** : D√©p√¥ts, retraits, transferts, paiements
    - üë• **Gestion utilisateurs** : Clients, distributeurs, marchands, admin
    - üí≥ **Gestion comptes** : Consultation solde, historique, blocage/d√©blocage
    - üîê **Authentification JWT** : Tokens s√©curis√©s avec cookies HTTP-only
    
    ## Authentification
    1. Utilisez l'endpoint `/api/auth/login` pour vous connecter
    2. Copiez le token depuis la r√©ponse (il est aussi dans un cookie HTTP-only)
    3. Cliquez sur "Authorize" et collez le token
    4. Testez les endpoints prot√©g√©s
    
    ## Donn√©es de test (Code PIN: 123456 pour tous)
    
    ### CLIENTS
    | Nom | T√©l√©phone | Mot de passe | Num√©ro de compte | Solde |
    |-----|-----------|--------------|------------------|-------|
    | Moussa Diop | 771234567 | Password123! | OM8000380279 | 50,000 FCFA |
    | Fatou Sarr | 779876543 | Pass123! | OM2665616523 | 25,000 FCFA |
    | Cheikh Fall | 776543210 | Client123! | OM5432147504 | 100,000 FCFA |
    
    ### DISTRIBUTEURS
    | Nom | T√©l√©phone | Mot de passe | Num√©ro de compte | Solde |
    |-----|-----------|--------------|------------------|-------|
    | Abdou Ndiaye | 775551234 | Distrib123! | OM4274060223 | 500,000 FCFA |
    | Mariama Kane | 778889999 | Distrib456! | (auto) | 750,000 FCFA |
    
    ### MARCHANDS
    | Nom Commercial | T√©l√©phone | Mot de passe | Code Marchand | Commission |
    |----------------|-----------|--------------|---------------|------------|
    | Boutique Chez Amadou | 771112233 | Marchand123! | SHOP001 | 1.5% |
    | Pharmacie Yaye Fatou | 775556789 | Marchand456! | PHARM001 | 2.0% |
    | Supermarch√© Al Baraka | 770001122 | Marchand789! | SUPER001 | 1.0% |
    
    ### ADMIN
    | Nom | T√©l√©phone | Mot de passe | Solde |
    |-----|-----------|--------------|-------|
    | System Admin | 771111111 | Admin123! | 1,000,000 FCFA |
    

  version: 1.0.0
  contact:
    name: Orange Money Support
    email: support@orangemoney.sn
    url: https://www.orangemoney.sn
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: https://om-pay-spring-boot-1.onrender.com
    description: Serveur de production (Render)
  - url: http://localhost:8083
    description: Serveur de d√©veloppement local

tags:
  - name: Authentification
    description: Gestion de l'authentification et des sessions utilisateur
  - name: Utilisateurs
    description: Gestion des utilisateurs (CRUD)
  - name: Comptes
    description: Gestion des comptes bancaires
  - name: Transactions
    description: Op√©rations de d√©p√¥t, retrait, transfert et paiement

security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Token JWT obtenu apr√®s login.
        Le token est automatiquement stock√© dans un cookie HTTP-only.
        Pour Swagger, copiez le token depuis la r√©ponse du login.

  schemas:
    RegisterRequest:
      type: object
      required:
        - nom
        - prenom
        - telephone
        - email
        - motDePasse
        - codePin
        - role
      properties:
        nom:
          type: string
          description: "Nom de famille"
          example: 'Sow'
        prenom:
          type: string
          description: "Pr√©nom"
          example: 'Aminata'
        telephone:
          type: string
          pattern: '^(77|78|76|70|75)[0-9]{7}$'
          description: "Num√©ro de t√©l√©phone s√©n√©galais (9 chiffres)"
          example: '778889999'
        email:
          type: string
          format: email
          description: "Adresse email"
          example: 'aminata.sow@test.com'
        motDePasse:
          type: string
          format: password
          description: "Mot de passe (min 8 caract√®res, 1 majuscule, 1 chiffre, 1 caract√®re sp√©cial)"
          example: 'Secure123!'
        codePin:
          type: string
          pattern: '^[0-9]{6}$'
          description: "Code PIN √† 6 chiffres"
          example: '123456'
        role:
          type: string
          enum: [CLIENT, DISTRIBUTEUR, MARCHAND, ADMIN]
          description: "R√¥le de l'utilisateur"
          example: 'CLIENT'

    LoginRequest:
      type: object
      required:
        - telephone
        - motDePasse
      properties:
        telephone:
          type: string
          description: "T√©l√©phone de l'utilisateur"
          example: '771234567'
        motDePasse:
          type: string
          format: password
          description: "Mot de passe de l'utilisateur"
          example: 'Password123!'

    TransfertRequest:
      type: object
      required:
        - montant
      properties:
        telephoneDestinataire:
          type: string
          description: "T√©l√©phone du destinataire (fournir SOIT t√©l√©phone SOIT codeQr)"
          example: '779876543'
        codeQrDestinataire:
          type: string
          description: "Code QR du destinataire (alternative au t√©l√©phone)"
          example: null
        montant:
          type: number
          format: double
          minimum: 100
          maximum: 1000000
          example: 5000

    DepotRequest:
      type: object
      required:
        - montant
      properties:
        telephoneClient:
          type: string
          description: "T√©l√©phone du client (fournir SOIT t√©l√©phone SOIT codeQr)"
          example: '771234567'
        codeQr:
          type: string
          description: "Code QR du client (alternative au t√©l√©phone)"
          example: null
        montant:
          type: number
          format: double
          minimum: 100
          maximum: 5000000
          example: 50000

    RetraitRequest:
      type: object
      required:
        - montant
      properties:
        telephoneClient:
          type: string
          description: "T√©l√©phone du client (fournir SOIT t√©l√©phone SOIT codeQr)"
          example: '771234567'
        codeQr:
          type: string
          description: "Code QR du client (alternative au t√©l√©phone)"
          example: null
        montant:
          type: number
          format: double
          minimum: 100
          maximum: 500000
          example: 10000

    PaiementRequest:
      type: object
      required:
        - montant
      properties:
        codeMarchand:
          type: string
          description: "Code du marchand (fournir SOIT codeMarchand SOIT codeQr)"
          example: 'SHOP001'
        codeQr:
          type: string
          description: "Code QR du marchand (alternative au codeMarchand)"
          example: null
        montant:
          type: number
          format: double
          minimum: 100
          maximum: 1000000
          example: 15000

    AuthResponse:
      type: object
      properties:
        type:
          type: string
          example: Bearer
        telephone:
          type: string
          example: '771234567'
        nom:
          type: string
          example: Diop
        prenom:
          type: string
          example: Moussa
        role:
          type: string
          example: CLIENT

    TransactionResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        reference:
          type: string
          example: TRXCC41124F
        typeTransaction:
          type: string
          enum: [DEPOT, RETRAIT, TRANSFERT, PAIEMENT]
          example: TRANSFERT
        montant:
          type: number
          format: double
          example: 5000.0
        frais:
          type: number
          format: double
          example: 100.0
        montantTotal:
          type: number
          format: double
          example: 5100.0
        statut:
          type: string
          enum: [EN_ATTENTE, REUSSI, ECHOUE, ANNULE]
          example: REUSSI
        nouveauSolde:
          type: number
          format: double
          description: Nouveau solde du compte exp√©diteur apr√®s la transaction
          example: 44900.0

    ApiResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: Op√©ration r√©ussie
        data:
          type: object
        timestamp:
          type: string
          format: date-time

paths:
  /api/auth/register:
    post:
      tags:
        - Authentification
      summary: Inscription d'un nouvel utilisateur
      description: Cr√©er un nouveau compte utilisateur
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            examples:
              nouveauClient:
                summary: Inscription nouveau CLIENT
                value:
                  nom: "Sow"
                  prenom: "Aminata"
                  telephone: "777778888"
                  email: "aminata.sow@test.com"
                  motDePasse: "Secure123!"
                  codePin: "123456"
                  role: "CLIENT"
              nouveauDistributeur:
                summary: Inscription nouveau DISTRIBUTEUR
                value:
                  nom: "Gueye"
                  prenom: "Ibrahima"
                  telephone: "775559999"
                  email: "ibrahima.gueye@distrib.com"
                  motDePasse: "Distrib789!"
                  codePin: "654321"
                  role: "DISTRIBUTEUR"
              nouveauMarchand:
                summary: Inscription nouveau MARCHAND
                value:
                  nom: "Thiam"
                  prenom: "Ousmane"
                  telephone: "770002233"
                  email: "ousmane@commerce.sn"
                  motDePasse: "Marchand999!"
                  codePin: "789012"
                  role: "MARCHAND"
      responses:
        '201':
          description: Inscription r√©ussie
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/auth/login:
    post:
      tags:
        - Authentification
      summary: Connexion utilisateur
      description: Authentifier un utilisateur
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              clientMoussa:
                summary: CLIENT - Moussa Diop (Solde: 50k)
                value:
                  telephone: "771234567"
                  motDePasse: "Password123!"
              clientFatou:
                summary: CLIENT - Fatou Sarr (Solde: 25k)
                value:
                  telephone: "779876543"
                  motDePasse: "Pass123!"
              clientCheikh:
                summary: CLIENT - Cheikh Fall (Solde: 100k)
                value:
                  telephone: "776543210"
                  motDePasse: "Client123!"
              distributeurAbdou:
                summary: DISTRIBUTEUR - Abdou Ndiaye (Solde: 500k)
                value:
                  telephone: "775551234"
                  motDePasse: "Distrib123!"
              distributeurMariama:
                summary: DISTRIBUTEUR - Mariama Kane (Solde: 750k)
                value:
                  telephone: "778889999"
                  motDePasse: "Distrib456!"
              marchandShop:
                summary: MARCHAND - Boutique Chez Amadou (SHOP001)
                value:
                  telephone: "771112233"
                  motDePasse: "Marchand123!"
              marchandPharma:
                summary: MARCHAND - Pharmacie Yaye Fatou (PHARM001)
                value:
                  telephone: "775556789"
                  motDePasse: "Marchand456!"
              admin:
                summary: ADMIN - System Admin
                value:
                  telephone: "771111111"
                  motDePasse: "Admin123!"
      responses:
        '200':
          description: Connexion r√©ussie
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/auth/logout:
    post:
      tags:
        - Authentification
      summary: D√©connexion
      description: D√©connecter l'utilisateur
      responses:
        '200':
          description: D√©connexion r√©ussie

  /api/auth/me:
    get:
      tags:
        - Authentification
      summary: Utilisateur connect√©
      description: Informations de l'utilisateur connect√©
      responses:
        '200':
          description: Informations r√©cup√©r√©es

  /api/transactions/transfert:
    post:
      tags:
        - Transactions
      summary: Transfert d'argent
      description: |
        Transf√©rer de l'argent entre deux clients.
        **Frais**: 0.85% du montant
        
        **Note**: Fournir SOIT `telephoneDestinataire` SOIT `codeQrDestinataire`, pas les deux.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransfertRequest'
            examples:
              versF atou:
                summary: Transfert vers Fatou Sarr (779876543)
                value:
                  telephoneDestinataire: "779876543"
                  montant: 5000
              versCheikh:
                summary: Transfert vers Cheikh Fall (776543210)
                value:
                  telephoneDestinataire: "776543210"
                  montant: 10000
              avecQrCode:
                summary: Transfert avec QR Code
                value:
                  codeQrDestinataire: "QR434B512D054A4817"
                  montant: 5000
      responses:
        '201':
          description: Transfert r√©ussi
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/transactions/depot:
    post:
      tags:
        - Transactions
      summary: D√©p√¥t d'argent
      description: |
        D√©poser de l'argent (DISTRIBUTEUR uniquement).
        **Frais**: 0 FCFA
        
        **Note**: Fournir SOIT `telephoneClient` SOIT `codeQr`, pas les deux.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DepotRequest'
            examples:
              depotMoussa:
                summary: D√©p√¥t vers Moussa Diop (771234567)
                value:
                  telephoneClient: "771234567"
                  montant: 50000
              depotFatou:
                summary: D√©p√¥t vers Fatou Sarr (779876543)
                value:
                  telephoneClient: "779876543"
                  montant: 25000
              avecQrCode:
                summary: D√©p√¥t avec QR Code
                value:
                  codeQr: "QR434B512D054A4817"
                  montant: 30000
      responses:
        '201':
          description: D√©p√¥t r√©ussi

  /api/transactions/retrait:
    post:
      tags:
        - Transactions
      summary: Retrait d'argent
      description: |
        Retirer de l'argent via distributeur.
        **Frais**: 0 FCFA (aucun frais)
        
        **Note**: Fournir SOIT `telephoneClient` SOIT `codeQr`, pas les deux.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RetraitRequest'
            examples:
              retraitMoussa:
                summary: Retrait de Moussa Diop (771234567)
                value:
                  telephoneClient: "771234567"
                  montant: 10000
              retraitCheikh:
                summary: Retrait de Cheikh Fall (776543210)
                value:
                  telephoneClient: "776543210"
                  montant: 20000
              avecQrCode:
                summary: Retrait avec QR Code
                value:
                  codeQr: "QR434B512D054A4817"
                  montant: 15000
      responses:
        '201':
          description: Retrait r√©ussi

  /api/transactions/paiement:
    post:
      tags:
        - Transactions
      summary: Paiement marchand
      description: |
        Payer un marchand.
        **Frais**: 0.85% du montant
        
        **Note**: Fournir SOIT `codeMarchand` SOIT `codeQr`, pas les deux.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaiementRequest'
            examples:
              boutique:
                summary: Paiement √† Boutique Chez Amadou (SHOP001)
                value:
                  codeMarchand: "SHOP001"
                  montant: 15000
              pharmacie:
                summary: Paiement √† Pharmacie Yaye Fatou (PHARM001)
                value:
                  codeMarchand: "PHARM001"
                  montant: 25000
              supermarche:
                summary: Paiement √† Supermarch√© Al Baraka (SUPER001)
                value:
                  codeMarchand: "SUPER001"
                  montant: 50000
              avecQrCode:
                summary: Paiement avec QR Code
                value:
                  codeQr: "QR434B512D054A4817"
                  montant: 20000
      responses:
        '201':
          description: Paiement r√©ussi

  /api/transactions/historique/{numeroCompte}:
    get:
      tags:
        - Transactions
      summary: Historique des transactions
      description: Historique complet
      parameters:
        - name: numeroCompte
          in: path
          required: true
          schema:
            type: string
            example: OM8000380279
      responses:
        '200':
          description: Historique r√©cup√©r√©

  /api/transactions/historique/{numeroCompte}/periode:
    get:
      tags:
        - Transactions
      summary: Historique par p√©riode
      parameters:
        - name: numeroCompte
          in: path
          required: true
          schema:
            type: string
        - name: dateDebut
          in: query
          required: true
          schema:
            type: string
            format: date-time
            example: '2025-11-08T00:00:00'
        - name: dateFin
          in: query
          required: true
          schema:
            type: string
            format: date-time
            example: '2025-11-08T23:59:59'
      responses:
        '200':
          description: Historique r√©cup√©r√©

  /api/transactions/annuler/{reference}:
    post:
      tags:
        - Transactions
      summary: Annuler une transaction
      description: |
        Annuler un transfert ou paiement effectu√©.
        Seul l'exp√©diteur peut annuler sa propre transaction.
        Le montant + frais sont rembours√©s automatiquement.
      parameters:
        - name: reference
          in: path
          required: true
          schema:
            type: string
            example: TRXABC12345
          description: R√©f√©rence de la transaction √† annuler
      responses:
        '200':
          description: Transaction annul√©e avec succ√®s
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Transaction d√©j√† annul√©e ou non annulable
        '401':
          description: Vous ne pouvez annuler que vos propres transactions
        '404':
          description: Transaction non trouv√©e

  /api/comptes/solde/{numeroCompte}:
    get:
      tags:
        - Comptes
      summary: Consulter le solde
      parameters:
        - name: numeroCompte
          in: path
          required: true
          schema:
            type: string
            example: OM8000380279
      responses:
        '200':
          description: Solde r√©cup√©r√©

  /api/comptes/utilisateur/{utilisateurId}:
    get:
      tags:
        - Comptes
      summary: Comptes d'un utilisateur
      parameters:
        - name: utilisateurId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Liste des comptes
